# Title: Konflux Configuration
# Description: Complete Konflux configuration with all components (UI, Build Service, Integration Service, Release Service, etc.)
#
# This sample provides a secure, minimal default configuration for production deployments.
# It requires OIDC authentication (GitHub, Google, LDAP, etc.) to be configured via the
# dex components or elsewhere.
#
# Usage:
#   Production: Standard deployment (requires OIDC setup)
#   Local: This file is no longer used by default for local dev. See konflux_v1alpha1_konflux_demo.yaml
apiVersion: konflux.konflux-ci.dev/v1alpha1
kind: Konflux
metadata:
  labels:
    app.kubernetes.io/name: konflux-operator
    app.kubernetes.io/managed-by: kustomize
  name: konflux
spec:
  ui:
    spec:
      # NodePort exposes the UI on the host for Kind clusters.
      # Kind maps container port 30011 to host port 9443 (see kind-config.yaml).
      # Access the UI at https://localhost:9443 (HTTPS required).
      # For non-Kind clusters, use Ingress instead (see konflux_v1alpha1_konfluxui.yaml).
      ingress:
        nodePortService:
          httpsPort: 30011
      proxy:
        replicas: 1
        nginx:
          resources:
            requests:
              cpu: 30m
              memory: 128Mi
            limits:
              cpu: 30m
              memory: 128Mi
      dex:
        config:
          enablePasswordDB: false
          # Configure OIDC connectors here for production.
          # See docs/operator-deployment.md for production authentication examples
  integrationService:
    spec:
      integrationControllerManager:
        replicas: 1
        manager:
          resources:
            requests:
              cpu: 30m
              memory: 128Mi
            limits:
              cpu: 30m
              memory: 128Mi
  releaseService:
    spec:
      releaseControllerManager:
        replicas: 1
        manager:
          resources:
            requests:
              cpu: 30m
              memory: 128Mi
            limits:
              cpu: 30m
              memory: 128Mi
  buildService:
    spec:
      buildControllerManager:
        replicas: 1
        manager:
          resources:
            requests:
              cpu: 30m
              memory: 128Mi
            limits:
              cpu: 30m
              memory: 128Mi
  namespaceLister:
    spec:
      namespaceLister:
        replicas: 1
        namespaceLister:
          resources:
            requests:
              cpu: 100m
              memory: 128Mi
            limits:
              cpu: 500m
              memory: 256Mi
  info:
    spec:
      publicInfo:
        environment: prod
        visibility: public
  certManager:
    # CreateClusterIssuer controls whether cluster issuer resources are created
    # Defaults to true if not specified
    createClusterIssuer: true
  internalRegistry:
    # Enabled controls whether internal registry resources are deployed
    # Defaults to false if not specified
    # For local development on Kind, this provides an OCI registry at localhost:5001
    enabled: true
  # Default tenant creates a shared namespace ("default-tenant") accessible by all authenticated users.
  # All authenticated users get maintainer permissions in this namespace.
  # Appropriate for local development and testing. For production multi-tenant environments where
  # you need strict namespace isolation, set enabled: false and create per-team tenant namespaces.
  # Defaults to true if not specified.
  defaultTenant:
    enabled: true
