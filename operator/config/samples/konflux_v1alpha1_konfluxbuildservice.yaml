# Title: Konflux Build Service Configuration
# Description: KonfluxBuildService configuration with custom resource limits, environment variables,
#              and pipeline configuration options.
#
# Pipeline Configuration:
#   pipelineConfig controls the contents of the build-pipeline-config ConfigMap.
#   The operator always manages this ConfigMap. Use pipelineConfig to customize it:
#     - Override a default pipeline by specifying the same name with a different bundle
#     - Remove a specific default with removed: true
#     - Discard all defaults with removeDefaults: true
#     - Add new pipelines alongside or instead of defaults
#     - Set defaultPipelineName to specify which pipeline is selected by default for new components
apiVersion: konflux.konflux-ci.dev/v1alpha1
kind: KonfluxBuildService
metadata:
  labels:
    app.kubernetes.io/name: konflux-operator
    app.kubernetes.io/managed-by: kustomize
  name: konflux-build-service
spec:
  # pipelineConfig:
  #   # removeDefaults: true  # Discard all operator-provided default pipelines
  #   pipelines:
  #     - name: fbc-builder
  #       removed: true  # Remove this specific default pipeline
  #     - name: my-custom-pipeline
  #       bundle: quay.io/myorg/pipeline:latest
  #   # defaultPipelineName: fbc-builder  # Use existing default pipeline as default
  #   # defaultPipelineName: my-custom-pipeline  # Use custom pipeline as default
  buildControllerManager:
    replicas: 2
    manager:
      resources:
        requests:
          cpu: 100m
          memory: 256Mi
        limits:
          cpu: 500m
          memory: 512Mi
      env:
        - name: PAC_WEBHOOK_URL
          value: "http://pipelines-as-code-controller.pipelines-as-code.svc.cluster.local:8180"
        - name: EXAMPLE_CUSTOM_CONFIG
          valueFrom:
            configMapKeyRef:
              name: build-service-config
              key: custom-config
        - name: EXAMPLE_SECRET_VALUE
          valueFrom:
            secretKeyRef:
              name: build-service-secret
              key: secret-key
