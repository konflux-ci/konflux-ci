# DEPRECATED: This policy is deprecated and will be removed in the future.
# Use the reduce-tekton-pr-taskrun-resource-requests policy instead.
# This policy is no longer needed.

---
apiVersion: kyverno.io/v1
kind: ClusterPolicy
metadata:
  name: e2e-reduce-resources
spec:
  background: false
  rules:
  - name: e2e-reduce-resources
    match:
      any:
      - resources:
          kinds:
          - Pod
          operations:
          - CREATE
          selector:
            matchLabels:
              pipelinesascode.tekton.dev/original-prname: "NON_EXISTING_LABEL-NOT_REQUIRED_ANYMORE"
    mutate:
      foreach:
      - list: "request.object.spec.containers"
        preconditions:
          any:
          - key: "{{ element.resources.requests.memory || '' }}"
            operator: NotEquals
            value: ""
          - key: "{{ element.resources.requests.cpu || '' }}"
            operator: NotEquals
            value: ""
        patchesJson6902: |-
          - op: add
            path: /spec/containers/{{elementIndex}}/resources/requests
            value:
              memory: 256Mi
              cpu: 100m
