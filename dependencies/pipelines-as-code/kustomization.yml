---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - https://github.com/openshift-pipelines/pipelines-as-code/releases/download/v0.24.1/release.k8s.yaml
patches:
  - path: custom-console-patch.yaml
    target:
      kind: ConfigMap
      version: v1
      name: pipelines-as-code
  - patch: |
      - op: add
        path: /spec/template/spec/containers/0/securityContext
        value:
          readOnlyRootFilesystem: true
          runAsNonRoot: true
    target:
      kind: Deployment
      name: pipelines-as-code-controller
  - patch: |
      - op: add
        path: /spec/template/spec/containers/0/securityContext
        value:
          readOnlyRootFilesystem: true
          runAsNonRoot: true
    target:
      kind: Deployment
      name: pipelines-as-code-watcher
  - patch: |
      - op: add
        path: /spec/template/spec/containers/0/securityContext
        value:
          readOnlyRootFilesystem: true
          runAsNonRoot: true
    target:
      kind: Deployment
      name: pipelines-as-code-webhook
  - patch: |
      - op: add
        path: /spec/template/spec/containers/0/resources
        value:
          requests:
            cpu: 50m
            memory: 50Mi
          limits:
            cpu: 100m
            memory: 100Mi
    target:
      kind: Deployment
      name: pipelines-as-code-controller
  - patch: |
      - op: add
        path: /spec/template/spec/containers/0/resources
        value:
          requests:
            cpu: 50m
            memory: 50Mi
          limits:
            cpu: 100m
            memory: 100Mi
    target:
      kind: Deployment
      name: pipelines-as-code-watcher
  - patch: |
      - op: add
        path: /spec/template/spec/containers/0/resources
        value:
          requests:
            cpu: 50m
            memory: 50Mi
          limits:
            cpu: 100m
            memory: 100Mi
    target:
      kind: Deployment
      name: pipelines-as-code-webhook
  - patch: |
      - op: add
        path: /metadata/annotations/ignore-check.kube-linter.io~1env-var-secret
        value: "This is the name of the secret rather than the secret"
    target:
      kind: Deployment
      name: pipelines-as-code-controller
  - patch: |
      - op: add
        path: /metadata/annotations/ignore-check.kube-linter.io~1env-var-secret
        value: "This is the name of the secret rather than the secret"
    target:
      kind: Deployment
      name: pipelines-as-code-webhook
